<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Template Doctor - Leaderboards</title>
    <link rel="stylesheet" href="css/styles.css">
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            margin: 0;
            padding: 0;
            background: #f8fafc;
            min-height: 100vh;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            text-decoration: none;
            color: #1e293b;
        }

        .logo img {
            width: 40px;
            height: 40px;
        }

        .logo h1 {
            margin: 0;
            font-size: 24px;
            font-weight: 700;
        }

        .nav-links {
            display: flex;
            gap: 20px;
        }

        .nav-links a {
            text-decoration: none;
            color: #64748b;
            font-weight: 500;
            padding: 8px 16px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-links a:hover, .nav-links a.active {
            background: #3b82f6;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .dashboard-title {
            text-align: center;
            color: #1e293b;
            margin-bottom: 40px;
        }

        .dashboard-title h1 {
            font-size: 48px;
            margin: 0 0 10px 0;
            font-weight: 700;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .dashboard-title p {
            font-size: 18px;
            color: #64748b;
            margin: 0;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 24px;
            margin-bottom: 40px;
        }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin: 0 0 20px 0;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .chart-title .icon {
            font-size: 20px;
        }

        .leaderboard-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .leaderboard-item:last-child {
            border-bottom: none;
        }

        .leaderboard-rank {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .rank-number {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .rank-1 { background: #ffd700; color: #8b5a00; }
        .rank-2 { background: #c0c0c0; color: #4a4a4a; }
        .rank-3 { background: #cd7f32; color: #fff; }
        .rank-other { background: #e2e8f0; color: #64748b; }

        .user-info {
            display: flex;
            flex-direction: column;
        }

        .user-name {
            font-weight: 600;
            color: #1e293b;
        }

        .user-details {
            font-size: 12px;
            color: #64748b;
        }

        .score {
            font-weight: 700;
            color: #3b82f6;
            font-size: 18px;
        }

        .issue-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .issue-item:last-child {
            border-bottom: none;
        }

        .issue-severity {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
        }

        .severity-high { background: #fee2e2; color: #dc2626; }
        .severity-medium { background: #fef3c7; color: #d97706; }
        .severity-low { background: #dcfce7; color: #16a34a; }

        .template-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .template-item:last-child {
            border-bottom: none;
        }

        .template-name {
            font-weight: 500;
            color: #1e293b;
        }

        .template-author {
            font-size: 12px;
            color: #64748b;
        }

        .health-score {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .health-bar {
            width: 60px;
            height: 6px;
            background: #e2e8f0;
            border-radius: 3px;
            overflow: hidden;
        }

        .health-fill {
            height: 100%;
            border-radius: 3px;
        }

        .health-high { background: #16a34a; }
        .health-medium { background: #d97706; }
        .health-low { background: #dc2626; }

        .language-tag {
            background: #e0e7ff;
            color: #3730a3;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .model-tag {
            background: #fef3c7;
            color: #92400e;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 500;
        }

        .tech-usage-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e2e8f0;
        }

        .tech-usage-item:last-child {
            border-bottom: none;
        }

        .tech-info {
            display: flex;
            align-items: center;
            gap: 12px;
            min-width: 150px;
        }

        .tech-icon {
            font-size: 20px;
            width: 24px;
            text-align: center;
        }

        .tech-details {
            display: flex;
            flex-direction: column;
        }

        .tech-name {
            font-weight: 600;
            color: #1e293b;
            font-size: 14px;
        }

        .tech-percentage {
            font-size: 12px;
            color: #64748b;
            font-weight: 500;
        }

        .tech-bar-container {
            flex: 1;
            height: 8px;
            background: #e2e8f0;
            border-radius: 4px;
            margin-left: 20px;
            overflow: hidden;
        }

        .tech-bar {
            height: 100%;
            border-radius: 4px;
            transition: width 0.8s ease-in-out;
        }

        .chart-viz {
            min-height: 200px;
            margin-top: 16px;
        }

        .global-stats-section {
            margin-top: 60px;
            padding: 40px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            text-align: center;
        }

        .stats-section-title {
            color: white;
            font-size: 36px;
            font-weight: 700;
            margin: 0 0 40px 0;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
        }

        .big-stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 30px;
            max-width: 1000px;
            margin: 0 auto;
        }

        .big-stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px 30px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.2);
            border: 1px solid rgba(255, 255, 255, 0.3);
            position: relative;
            overflow: hidden;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .big-stat-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        .big-stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 5px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
        }

        .big-stat-number {
            font-size: 64px;
            font-weight: 900;
            background: linear-gradient(135deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 15px;
            line-height: 1;
        }

        .big-stat-label {
            font-size: 18px;
            font-weight: 600;
            color: #1e293b;
            margin-bottom: 20px;
            line-height: 1.3;
        }

        .big-stat-icon {
            font-size: 48px;
            position: absolute;
            top: 20px;
            right: 20px;
            opacity: 0.3;
        }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .dashboard-title h1 {
                font-size: 32px;
            }

            .big-stats-grid {
                grid-template-columns: 1fr;
                gap: 20px;
            }

            .big-stat-number {
                font-size: 48px;
            }

            .stats-section-title {
                font-size: 28px;
            }

            .global-stats-section {
                margin-top: 40px;
                padding: 30px 20px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-content">
            <a href="/" class="logo">
                <img src="assets/images/templatedoctor.svg" alt="Template Doctor">
                <h1>Template Doctor</h1>
            </a>
            <nav class="nav-links">
                <a href="/">Dashboard</a>
                <a href="/leaderboards" class="active">Leaderboards</a>
                <a href="/setup">Setup</a>
            </nav>
        </div>
    </header>

    <div class="container">
        <div class="dashboard-title">
            <h1>🏆 Leaderboards</h1>
            <p>Community insights and top performers across all collections</p>
        </div>

        <div class="stats-grid">
            <!-- Top Analyzers Overall -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">👑</span>
                    Top Analyzers (Overall)
                </h2>
                <div id="top-analyzers-overall"></div>
            </div>

            <!-- Top Analyzers for aigallery -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🎯</span>
                    Top Analyzers (aigallery)
                </h2>
                <div id="top-analyzers-aigallery"></div>
            </div>

            <!-- Most Successful Template Builders -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🛠️</span>
                    Most Successful Builders
                </h2>
                <div id="successful-builders"></div>
            </div>

            <!-- Templates with Most Issues -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">⚠️</span>
                    Templates with Most Issues
                </h2>
                <div id="most-issues"></div>
            </div>

            <!-- Most Prevalent Issues -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">📊</span>
                    Most Prevalent Issues
                </h2>
                <div id="prevalent-issues" class="chart-viz"></div>
            </div>

            <!-- Most Active Templates -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🔥</span>
                    Most Active Templates
                </h2>
                <div id="active-templates"></div>
            </div>

            <!-- Healthiest Templates by Language -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">💚</span>
                    Healthiest Templates (Python)
                </h2>
                <div id="healthy-python"></div>
            </div>

            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">💛</span>
                    Healthiest Templates (JavaScript)
                </h2>
                <div id="healthy-js"></div>
            </div>

            <!-- Most Successful Model -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🤖</span>
                    Most Successful Models
                </h2>
                <div id="successful-models" class="chart-viz"></div>
            </div>

            <!-- Model/Language Success in Healthy Templates -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🎯</span>
                    Model/Language Success (Healthy Templates)
                </h2>
                <div id="model-language-success" class="chart-viz"></div>
            </div>

            <!-- Most Successfully Deployed AZD Templates -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🚀</span>
                    Most Successfully Deployed (AZD)
                </h2>
                <div id="successful-azd-deployments"></div>
            </div>

            <!-- Other MSFT Tech Usage -->
            <div class="chart-container">
                <h2 class="chart-title">
                    <span class="icon">🔧</span>
                    Other MSFT Tech Used by Templates
                </h2>
                <div id="msft-tech-usage"></div>
            </div>
        </div>

        <!-- Global Statistics -->
        <div class="global-stats-section">
            <h2 class="stats-section-title">🌍 Global Impact</h2>
            <div class="big-stats-grid">
                <div class="big-stat-card">
                    <div class="big-stat-number" id="templates-mcp">200</div>
                    <div class="big-stat-label">Templates Created with Template Kit MCP</div>
                    <div class="big-stat-icon">🛠️</div>
                </div>
                <div class="big-stat-card">
                    <div class="big-stat-number" id="total-installs">18</div>
                    <div class="big-stat-label">Total Installs of Template Doctor Across Microsoft</div>
                    <div class="big-stat-icon">📈</div>
                </div>
                <div class="big-stat-card">
                    <div class="big-stat-number" id="templates-analyzed">5,000</div>
                    <div class="big-stat-label">Total Templates Analyzed Until Now</div>
                    <div class="big-stat-icon">🔍</div>
                </div>
            </div>
        </div>
    </div>
    </div>

    <script>
        // Check authentication - redirect to home if not logged in
        (function checkAuth() {
            const token = localStorage.getItem('github_access_token');
            if (!token) {
                console.log('Not authenticated, redirecting to home page');
                window.location.href = '/';
                return;
            }
        })();

        // Fake data
        const data = {
            topAnalyzersOverall: [
                { name: "Hailey Victory", analyses: 847, collections: 23, avatar: "🚀" },
                { name: "Marcus Chen", analyses: 723, collections: 19, avatar: "🔬" },
                { name: "Sarah Johnson", analyses: 651, collections: 17, avatar: "⚡" },
                { name: "Alex Rodriguez", analyses: 598, collections: 16, avatar: "🎯" },
                { name: "Emma Wilson", analyses: 542, collections: 14, avatar: "💡" }
            ],
            
            topAnalyzersAigallery: [
                { name: "Kristen Womack", analyses: 234, score: 98.5, avatar: "🌟" },
                { name: "David Kim", analyses: 187, score: 94.2, avatar: "🔍" },
                { name: "Lisa Brown", analyses: 156, score: 91.8, avatar: "📈" },
                { name: "Mike Taylor", analyses: 143, score: 89.4, avatar: "🎪" },
                { name: "Anna Garcia", analyses: 128, score: 87.1, avatar: "🎨" }
            ],
            
            successfulBuilders: [
                { name: "Pamela Fox", templates: 42, successRate: 96.8, totalDownloads: 125000, avatar: "🏗️" },
                { name: "Wassim Chegham", templates: 38, successRate: 94.2, totalDownloads: 98000, avatar: "⚒️" },
                { name: "John Doe", templates: 31, successRate: 91.5, totalDownloads: 76000, avatar: "🔨" },
                { name: "Jane Smith", templates: 28, successRate: 89.7, totalDownloads: 64000, avatar: "🛠️" }
            ],
            
            templatesWithIssues: [
                { name: "azure-search-openai-demo", author: "Azure-Samples", issues: 47, severity: "high" },
                { name: "serverless-chat-langchainjs", author: "Azure-Samples", issues: 43, severity: "high" },
                { name: "contoso-chat", author: "Azure-Samples", issues: 39, severity: "medium" },
                { name: "azure-search-openai-demo-csharp", author: "Azure-Samples", issues: 36, severity: "medium" },
                { name: "rag-postgres-openai-python", author: "Azure-Samples", issues: 34, severity: "medium" },
                { name: "openai-chat-app-quickstart", author: "Azure-Samples", issues: 31, severity: "low" },
                { name: "azure-search-openai-demo-java", author: "Azure-Samples", issues: 29, severity: "low" },
                { name: "llama-index-python", author: "Azure-Samples", issues: 27, severity: "low" },
                { name: "azure-openai-chat-frontend", author: "Azure-Samples", issues: 25, severity: "low" },
                { name: "azure-openai-assistant-javascript", author: "Azure-Samples", issues: 22, severity: "low" }
            ],
            
            prevalentIssues: [
                { category: "Security", issue: "Hardcoded API keys/secrets", count: 189 },
                { category: "Documentation", issue: "Missing or incomplete README", count: 167 },
                { category: "Dependencies", issue: "Outdated or vulnerable packages", count: 142 },
                { category: "Configuration", issue: "Missing environment variables", count: 124 },
                { category: "Deployment", issue: "Missing azd configuration", count: 98 },
                { category: "Testing", issue: "No test coverage or CI/CD", count: 87 },
                { category: "Performance", issue: "Unoptimized database queries", count: 73 },
                { category: "Accessibility", issue: "Missing ARIA labels/alt text", count: 56 }
            ],
            
            activeTemplates: [
                { name: "azure-search-openai-javascript", author: "Azure-Samples", activity: 245, stars: 1200 },
                { name: "summarization-openai-python-promptflow", author: "Azure-Samples", activity: 198, stars: 890 },
                { name: "llama-index-javascript", author: "Azure-Samples", activity: 176, stars: 2300 },
                { name: "phoenix-on-azure", author: "Arize-ai", activity: 165, stars: 1800 },
                { name: "openai-chat-vision-quickstart", author: "Azure-Samples", activity: 154, stars: 980 },
                { name: "agent-openai-java-banking-assistant", author: "Azure-Samples", activity: 143, stars: 1500 },
                { name: "ai-chat-quickstart-csharp", author: "Azure-Samples", activity: 132, stars: 670 },
                { name: "azure-openai-keyless-js", author: "Azure-Samples", activity: 121, stars: 1100 },
                { name: "azure-openai-keyless-python", author: "Azure-Samples", activity: 110, stars: 750 },
                { name: "cosmosdb-nosql-copilot", author: "AzureCosmosDB", activity: 98, stars: 1900 }
            ],
            
            healthyPython: [
                { name: "rag-postgres-openai-python", author: "Azure-Samples", health: 98, downloads: 45000 },
                { name: "azure-openai-keyless-python", author: "Azure-Samples", health: 96, downloads: 38000 },
                { name: "llama-index-python", author: "Azure-Samples", health: 94, downloads: 32000 },
                { name: "azureai-basic-python", author: "Azure-Samples", health: 92, downloads: 28000 },
                { name: "rag-neon-postgres-openai-azure-python", author: "neondatabase-labs", health: 90, downloads: 25000 }
            ],
            
            healthyJS: [
                { name: "azure-search-openai-javascript", author: "Azure-Samples", health: 97, downloads: 52000 },
                { name: "azure-openai-assistant-javascript", author: "Azure-Samples", health: 95, downloads: 48000 },
                { name: "llama-index-javascript", author: "Azure-Samples", health: 93, downloads: 41000 },
                { name: "azure-openai-keyless-js", author: "Azure-Samples", health: 91, downloads: 35000 },
                { name: "openai-secure-ui-js", author: "Azure-Samples", health: 89, downloads: 30000 }
            ],
            
            successfulModels: [
                { model: "GPT-4o", success: 96.8, templates: 189 },
                { model: "Claude-3.5-Sonnet", success: 94.2, templates: 156 },
                { model: "GPT-4-Turbo", success: 92.1, templates: 143 },
                { model: "Claude-3-Haiku", success: 89.7, templates: 124 },
                { model: "Gemini-1.5-Pro", success: 88.5, templates: 108 },
                { model: "GPT-3.5-Turbo", success: 85.3, templates: 98 },
                { model: "Llama-3.1-405B", success: 83.9, templates: 87 },
                { model: "Phi-3.5-Mini", success: 81.4, templates: 76 },
                { model: "Mistral-Large", success: 79.2, templates: 65 }
            ],
            
            modelLanguageSuccess: [
                { model: "GPT-4o", language: "Python", success: 97.5, templates: 89 },
                { model: "GPT-4o", language: "JavaScript", success: 94.8, templates: 76 },
                { model: "Claude-3.5-Sonnet", language: "Python", success: 96.2, templates: 83 },
                { model: "Claude-3.5-Sonnet", language: "JavaScript", success: 92.7, templates: 67 },
                { model: "GPT-4-Turbo", language: "Python", success: 94.1, templates: 71 },
                { model: "GPT-4-Turbo", language: "JavaScript", success: 90.4, templates: 58 },
                { model: "Gemini-1.5-Pro", language: "Python", success: 91.8, templates: 54 },
                { model: "Gemini-1.5-Pro", language: "JavaScript", success: 87.3, templates: 43 },
                { model: "Llama-3.1-405B", language: "Python", success: 89.6, templates: 48 },
                { model: "Llama-3.1-405B", language: "JavaScript", success: 84.2, templates: 35 },
                { model: "Phi-3.5-Mini", language: "Python", success: 86.7, templates: 41 },
                { model: "Phi-3.5-Mini", language: "JavaScript", success: 81.9, templates: 32 }
            ],
            
            successfulAzdDeployments: [
                { name: "contoso-chat", author: "Azure-Samples", service: "ACA", deployments: 1247, successRate: 98.2 },
                { name: "azure-search-openai-demo", author: "Azure-Samples", service: "ACA", deployments: 1156, successRate: 96.8 },
                { name: "rag-postgres-openai-python", author: "Azure-Samples", service: "ACA", deployments: 934, successRate: 95.4 },
                { name: "java-on-aca", author: "Azure-Samples", service: "AKS", deployments: 823, successRate: 94.1 },
                { name: "azure-functions-openai-aisearch-node", author: "Azure-Samples", service: "AF", deployments: 756, successRate: 92.7 }
            ],
            
            msftTechUsage: [
                { tech: "Playwright", usage: 78, color: "#2e8b57", icon: "🎭" },
                { tech: "TypeScript", usage: 59, color: "#3178c6", icon: "📘" },
                { tech: "Semantic Kernel", usage: 45, color: "#9b59b6", icon: "🧠" },
                { tech: "Azure AI Studio", usage: 38, color: "#0078d4", icon: "🤖" },
                { tech: "TypeSpec", usage: 15, color: "#e67e22", icon: "📝" },
                { tech: "ONNX Runtime", usage: 12, color: "#27ae60", icon: "⚡" }
            ],
            
            globalStats: {
                templatesCreatedWithMCP: 200,
                totalInstallsAcrossMicrosoft: 18,
                totalTemplatesAnalyzed: 5000
            }
        };

        // Render functions
        function renderLeaderboard(containerId, items, scoreKey, detailsKey) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, index) => {
                const rankClass = index === 0 ? 'rank-1' : index === 1 ? 'rank-2' : index === 2 ? 'rank-3' : 'rank-other';
                return `
                    <div class="leaderboard-item">
                        <div class="leaderboard-rank">
                            <div class="rank-number ${rankClass}">${index + 1}</div>
                            <div class="user-info">
                                <div class="user-name">${item.avatar} ${item.name}</div>
                                <div class="user-details">${item[detailsKey] || ''}</div>
                            </div>
                        </div>
                        <div class="score">${item[scoreKey]}</div>
                    </div>
                `;
            }).join('');
        }

        function renderIssuesList(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, index) => `
                <div class="issue-item">
                    <div>
                        <div class="template-name">${item.name}</div>
                        <div class="template-author">by ${item.author}</div>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <span class="issue-severity severity-${item.severity}">${item.severity}</span>
                        <span class="score">${item.issues}</span>
                    </div>
                </div>
            `).join('');
        }

        function renderTemplatesList(containerId, items, showHealth = false) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, index) => {
                const healthClass = item.health >= 90 ? 'health-high' : item.health >= 70 ? 'health-medium' : 'health-low';
                return `
                    <div class="template-item">
                        <div>
                            <div class="template-name">${item.name}</div>
                            <div class="template-author">by ${item.author}</div>
                        </div>
                        <div class="health-score">
                            ${showHealth ? `
                                <div class="health-bar">
                                    <div class="health-fill ${healthClass}" style="width: ${item.health}%"></div>
                                </div>
                                <span>${item.health}%</span>
                            ` : `
                                <span class="score">${item.activity || item.stars || item.downloads}</span>
                            `}
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderAzdDeploymentsList(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, index) => {
                const serviceColors = {
                    'ACA': { bg: '#e0f2fe', color: '#0277bd' },
                    'AKS': { bg: '#f3e5f5', color: '#7b1fa2' },
                    'AF': { bg: '#e8f5e8', color: '#2e7d32' }
                };
                const serviceColor = serviceColors[item.service] || { bg: '#f5f5f5', color: '#424242' };
                
                return `
                    <div class="template-item">
                        <div>
                            <div class="template-name">${item.name}</div>
                            <div class="template-author">by ${item.author}</div>
                        </div>
                        <div style="display: flex; align-items: center; gap: 12px;">
                            <span class="service-tag" style="background: ${serviceColor.bg}; color: ${serviceColor.color}; padding: 4px 8px; border-radius: 12px; font-size: 12px; font-weight: 500;">${item.service}</span>
                            <div style="text-align: right;">
                                <div class="score">${item.deployments}</div>
                                <div style="font-size: 12px; color: #64748b;">${item.successRate}% success</div>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        function renderMsftTechUsage(containerId, items) {
            const container = document.getElementById(containerId);
            container.innerHTML = items.map((item, index) => {
                return `
                    <div class="tech-usage-item">
                        <div class="tech-info">
                            <span class="tech-icon">${item.icon}</span>
                            <div class="tech-details">
                                <div class="tech-name">${item.tech}</div>
                                <div class="tech-percentage">${item.usage}%</div>
                            </div>
                        </div>
                        <div class="tech-bar-container">
                            <div class="tech-bar" style="width: ${item.usage}%; background: ${item.color};"></div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // D3.js Charts
        function createBarChart(containerId, data, xKey, yKey, color = '#3b82f6') {
            const container = d3.select(`#${containerId}`);
            container.selectAll("*").remove();

            const margin = { top: 20, right: 30, bottom: 40, left: 80 };
            const width = 300 - margin.left - margin.right;
            const height = 400 - margin.bottom - margin.top;

            const svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const x = d3.scaleLinear()
                .domain([0, d3.max(data, d => d[yKey])])
                .range([0, width]);

            const y = d3.scaleBand()
                .domain(data.map(d => d[xKey]))
                .range([0, height])
                .padding(0.1);

            g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", 0)
                .attr("y", d => y(d[xKey]))
                .attr("width", d => x(d[yKey]))
                .attr("height", y.bandwidth())
                .attr("fill", color)
                .attr("rx", 4);

            g.selectAll(".label")
                .data(data)
                .enter().append("text")
                .attr("class", "label")
                .attr("x", d => x(d[yKey]) + 5)
                .attr("y", d => y(d[xKey]) + y.bandwidth() / 2)
                .attr("dy", "0.35em")
                .style("font-size", "12px")
                .style("fill", "#374151")
                .text(d => d[yKey]);

            g.append("g")
                .call(d3.axisLeft(y))
                .style("font-size", "10px");
        }

        function createPieChart(containerId, data, categoryKey, valueKey) {
            const container = d3.select(`#${containerId}`);
            container.selectAll("*").remove();

            const width = 350;
            const pieHeight = 280;
            const legendHeight = 120;
            const height = pieHeight + legendHeight;
            const margin = 20;
            const radius = Math.min(width, pieHeight) / 2 - margin;

            const svg = container.append("svg")
                .attr("width", width)
                .attr("height", height);

            const g = svg.append("g")
                .attr("transform", `translate(${width/2}, ${pieHeight/2})`);

            const color = d3.scaleOrdinal()
                .domain(data.map(d => d[categoryKey]))
                .range(['#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#ffeaa7', '#98d8c8', '#f7dc6f', '#ffaaa5']);

            const pie = d3.pie()
                .value(d => d[valueKey])
                .sort(null);

            const arc = d3.arc()
                .innerRadius(0)
                .outerRadius(radius);

            const labelArc = d3.arc()
                .outerRadius(radius - 10)
                .innerRadius(radius - 10);

            const arcs = g.selectAll(".arc")
                .data(pie(data))
                .enter().append("g")
                .attr("class", "arc");

            arcs.append("path")
                .attr("d", arc)
                .style("fill", d => color(d.data[categoryKey]))
                .style("stroke", "white")
                .style("stroke-width", "2px");

            arcs.append("text")
                .attr("transform", d => `translate(${labelArc.centroid(d)})`)
                .attr("dy", "0.35em")
                .style("text-anchor", "middle")
                .style("font-size", "10px")
                .style("font-weight", "500")
                .text(d => d.data.count > 50 ? d.data[categoryKey] : '');

            // Legend at bottom
            const legendData = color.domain();
            const itemsPerRow = 2;
            const legendStartY = pieHeight + 20;
            
            const legend = svg.selectAll(".legend")
                .data(legendData)
                .enter().append("g")
                .attr("class", "legend")
                .attr("transform", (d, i) => {
                    const row = Math.floor(i / itemsPerRow);
                    const col = i % itemsPerRow;
                    const x = 20 + col * 140;
                    const y = legendStartY + row * 18;
                    return `translate(${x}, ${y})`;
                });

            legend.append("rect")
                .attr("x", 0)
                .attr("width", 12)
                .attr("height", 12)
                .style("fill", color)
                .attr("rx", 2);

            legend.append("text")
                .attr("x", 18)
                .attr("y", 6)
                .attr("dy", "0.35em")
                .style("font-size", "10px")
                .text(d => d);
        }

        function createHeatmap(containerId, data) {
            const container = d3.select(`#${containerId}`);
            container.selectAll("*").remove();

            const margin = { top: 50, right: 30, bottom: 60, left: 100 };
            const width = 280 - margin.left - margin.right;
            const height = 400 - margin.top - margin.bottom;

            const svg = container.append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom);

            const g = svg.append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            const models = [...new Set(data.map(d => d.model))];
            const languages = [...new Set(data.map(d => d.language))];

            const x = d3.scaleBand()
                .domain(languages)
                .range([0, width])
                .padding(0.05);

            const y = d3.scaleBand()
                .domain(models)
                .range([height, 0])
                .padding(0.05);

            const colorScale = d3.scaleSequential(d3.interpolateBlues)
                .domain([80, 100]);

            g.selectAll(".cell")
                .data(data)
                .enter().append("rect")
                .attr("class", "cell")
                .attr("x", d => x(d.language))
                .attr("y", d => y(d.model))
                .attr("width", x.bandwidth())
                .attr("height", y.bandwidth())
                .attr("fill", d => colorScale(d.success))
                .attr("rx", 4);

            g.selectAll(".cell-text")
                .data(data)
                .enter().append("text")
                .attr("class", "cell-text")
                .attr("x", d => x(d.language) + x.bandwidth() / 2)
                .attr("y", d => y(d.model) + y.bandwidth() / 2)
                .attr("text-anchor", "middle")
                .attr("dy", "0.35em")
                .style("font-size", "10px")
                .style("fill", "white")
                .style("font-weight", "bold")
                .text(d => `${d.success}%`);

            g.append("g")
                .attr("transform", `translate(0,${height})`)
                .call(d3.axisBottom(x))
                .style("font-size", "10px");

            g.append("g")
                .call(d3.axisLeft(y))
                .style("font-size", "10px");
        }

        // Animate big numbers
        function animateNumber(elementId, finalValue, duration = 2000) {
            const element = document.getElementById(elementId);
            const startValue = 0;
            const increment = finalValue / (duration / 16);
            let currentValue = startValue;

            const timer = setInterval(() => {
                currentValue += increment;
                if (currentValue >= finalValue) {
                    currentValue = finalValue;
                    clearInterval(timer);
                }
                // Format number with commas
                const formattedNumber = Math.floor(currentValue).toLocaleString('en-US');
                element.textContent = formattedNumber;
            }, 16);
        }

        // Initialize all charts and lists
        document.addEventListener('DOMContentLoaded', function() {
            // Leaderboards
            renderLeaderboard('top-analyzers-overall', data.topAnalyzersOverall, 'analyses', 'collections');
            renderLeaderboard('top-analyzers-aigallery', data.topAnalyzersAigallery, 'analyses', 'score');
            renderLeaderboard('successful-builders', data.successfulBuilders, 'templates', 'successRate');

            // Issue lists
            renderIssuesList('most-issues', data.templatesWithIssues);

            // Template lists
            renderTemplatesList('active-templates', data.activeTemplates);
            renderTemplatesList('healthy-python', data.healthyPython, true);
            renderTemplatesList('healthy-js', data.healthyJS, true);
            renderAzdDeploymentsList('successful-azd-deployments', data.successfulAzdDeployments);
            renderMsftTechUsage('msft-tech-usage', data.msftTechUsage);

            // D3 Charts
            createPieChart('prevalent-issues', data.prevalentIssues, 'category', 'count');
            createBarChart('successful-models', data.successfulModels, 'model', 'success', '#10b981');
            createHeatmap('model-language-success', data.modelLanguageSuccess);

            // Animate big statistics with delay for visual impact
            setTimeout(() => {
                animateNumber('templates-mcp', data.globalStats.templatesCreatedWithMCP, 2500);
                animateNumber('total-installs', data.globalStats.totalInstallsAcrossMicrosoft, 3000);
                animateNumber('templates-analyzed', data.globalStats.totalTemplatesAnalyzed, 2000);
            }, 500);
        });
    </script>
</body>
</html>