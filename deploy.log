
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🚀 Template Doctor Deployment
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🔍 Running pre-deployment validation...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🔍 PRE-DEPLOYMENT CHECKLIST
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📦 Step 1: Building server TypeScript...

> template-doctor-server@1.0.0 build
> tsc

✅ Server built successfully

📦 Step 2: Building frontend...

> template-doctor-frontend@0.0.1 prebuild
> node scripts/sync-static-files.js

✓ Copied results/ directory
✓ Synced 20 static files to public/

> template-doctor-frontend@0.0.1 build
> vite build

[33mThe CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.[39m
vite v5.4.20 building for production...
transforming...
✓ 58 modules transformed.
rendering chunks...
computing gzip size...
dist/callback.html                            6.22 kB │ gzip:  1.88 kB
dist/assets/templatemcp-Ct7agV9G.svg          8.97 kB │ gzip:  2.25 kB
dist/assets/templateframework-KbuhChaH.svg    9.20 kB │ gzip:  2.22 kB
dist/index.html                              12.03 kB │ gzip:  3.33 kB
dist/assets/templatedoctor-DFkL0nYn.svg      13.44 kB │ gzip:  4.23 kB
dist/setup.html                              27.63 kB │ gzip:  5.94 kB
dist/leaderboards.html                       46.85 kB │ gzip:  8.82 kB
dist/css/style.css                           14.42 kB │ gzip:  3.27 kB
dist/css/main.css                            20.30 kB │ gzip:  4.64 kB
dist/assets/runtime-config-DfCyKGP5.js       10.60 kB │ gzip:  3.72 kB │ map:  31.44 kB
dist/assets/main-WywRoJnb.js                224.71 kB │ gzip: 62.69 kB │ map: 635.14 kB
✓ built in 463ms
✅ Frontend built successfully

📦 Step 3: Verifying build artifacts...
✅ All build artifacts present

📊 Build sizes:
  packages/app/dist/callback.html: 6.1K
  packages/app/dist/index.html: 12K
  packages/app/dist/leaderboards.html: 46K
  packages/app/dist/setup.html: 27K

leaderboards.html size:
 48K	packages/app/dist/leaderboards.html

📦 Step 4: Generating build checksums...
xargs: shasum: terminated with signal 13; aborting
✅ Build hashes saved to .build-hashes

Top 3 server files:
  Server
  packages/server/dist/analyzer-core/index.js
  packages/server/dist/analyzer-core/run-analyzer.js

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ PRE-DEPLOYMENT CHECKLIST PASSED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

📋 Build artifacts ready for deployment
   Hashes: .build-hashes

Ready to deploy! Run: ./scripts/deploy.sh

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

WARNING: your version of azd is out of date, you have 1.20.0 and the latest version is 1.20.1

To update to the latest version, run:
curl -fsSL https://aka.ms/install-azd.sh | bash

If the install script was run with custom parameters, ensure that the same parameters are used for the upgrade. For advanced install instructions, see: https://aka.ms/azd/upgrade/mac
📦 Building Docker image in Azure Container Registry...
   Registry: crx5oyap6bsi4si

   Image tags: latest, build-20251018-141825

WARNING: Packing source code into tar to upload...
WARNING: Excluding '.gitignore' based on default ignore rules
WARNING: Excluding '.git' based on default ignore rules
WARNING: Uploading archived source code from '/var/folders/12/p3s0448d7s1733ywdz1xrq6c0000gn/T/build_archive_b0b41574bc3f43ba8cb4be56c0ec8e13.tar.gz'...
WARNING: Sending context (41.630 MiB) to registry: crx5oyap6bsi4si...
WARNING: Queued a build with ID: dtk
WARNING: Waiting for an agent...
2025/10/18 12:20:09 Downloading source code...
2025/10/18 12:20:12 Finished downloading source code
2025/10/18 12:20:13 Using acb_vol_03a63644-1224-49b4-a4d1-d1d4b7b7f1a8 as the home volume
2025/10/18 12:20:13 Setting up Docker configuration...
2025/10/18 12:20:13 Successfully set up Docker configuration
2025/10/18 12:20:13 Logging in to registry: crx5oyap6bsi4si.azurecr.io
2025/10/18 12:20:14 Successfully logged into crx5oyap6bsi4si.azurecr.io
2025/10/18 12:20:14 Executing step ID: build. Timeout(sec): 28800, Working directory: '', Network: ''
2025/10/18 12:20:14 Scanning for dependencies...
2025/10/18 12:20:14 Successfully scanned dependencies
2025/10/18 12:20:14 Launching container with name: build
Sending build context to Docker daemon  32.87MB
Step 1/24 : FROM node:20-alpine AS builder
20-alpine: Pulling from library/node
2d35ebdb57d9: Pulling fs layer
c087321cece4: Pulling fs layer
f2fbe8556258: Pulling fs layer
c74c90aa7c87: Pulling fs layer
c74c90aa7c87: Waiting
f2fbe8556258: Verifying Checksum
f2fbe8556258: Download complete
2d35ebdb57d9: Verifying Checksum
2d35ebdb57d9: Download complete
2d35ebdb57d9: Pull complete
c74c90aa7c87: Verifying Checksum
c74c90aa7c87: Download complete
c087321cece4: Verifying Checksum
c087321cece4: Download complete
c087321cece4: Pull complete
f2fbe8556258: Pull complete
c74c90aa7c87: Pull complete
Digest: sha256:1ab6fc5a31d515dc7b6b25f6acfda2001821f2c2400252b6cb61044bd9f9ad48
Status: Downloaded newer image for node:20-alpine
 ---> 30c8b6e55a5d
Step 2/24 : WORKDIR /app
 ---> Running in 24e358c77f0f
Removing intermediate container 24e358c77f0f
 ---> 5505edd98a86
Step 3/24 : COPY packages/app/package*.json ./app/
 ---> bbd6c419c950
Step 4/24 : WORKDIR /app/app
 ---> Running in 7fb4dc351dc7
Removing intermediate container 7fb4dc351dc7
 ---> 438457d055e4
Step 5/24 : RUN npm install
 ---> Running in 310b9bbbd2e8

added 14 packages, and audited 15 packages in 8s

4 packages are looking for funding
  run `npm fund` for details

2 moderate severity vulnerabilities

To address all issues (including breaking changes), run:
  npm audit fix --force

Run `npm audit` for details.
npm notice
npm notice New major version of npm available! 10.8.2 -> 11.6.2
npm notice Changelog: https://github.com/npm/cli/releases/tag/v11.6.2
npm notice To update run: npm install -g npm@11.6.2
npm notice
Removing intermediate container 310b9bbbd2e8
 ---> b76ed099075f
Step 6/24 : COPY packages/app/ ./
 ---> 27203af726fa
Step 7/24 : RUN npm run build
 ---> Running in 79f7909b3f8d

> template-doctor-frontend@0.0.1 prebuild
> node scripts/sync-static-files.js

✓ Copied results/ directory
✓ Synced 20 static files to public/

> template-doctor-frontend@0.0.1 build
> vite build

The CJS build of Vite's Node API is deprecated. See https://vite.dev/guide/troubleshooting.html#vite-cjs-node-api-deprecated for more details.
vite v5.4.20 building for production...
transforming...
✓ 58 modules transformed.
rendering chunks...
computing gzip size...
dist/callback.html                            6.22 kB │ gzip:  1.88 kB
dist/assets/templatemcp-Ct7agV9G.svg          8.97 kB │ gzip:  2.25 kB
dist/assets/templateframework-KbuhChaH.svg    9.20 kB │ gzip:  2.22 kB
dist/index.html                              12.03 kB │ gzip:  3.33 kB
dist/assets/templatedoctor-DFkL0nYn.svg      13.44 kB │ gzip:  4.23 kB
dist/setup.html                              27.63 kB │ gzip:  5.94 kB
dist/leaderboards.html                       46.85 kB │ gzip:  8.82 kB
dist/css/style.css                           14.42 kB │ gzip:  3.27 kB
dist/css/main.css                            20.30 kB │ gzip:  4.64 kB
dist/assets/runtime-config-DfCyKGP5.js       10.60 kB │ gzip:  3.72 kB │ map:  31.44 kB
dist/assets/main-WywRoJnb.js                224.71 kB │ gzip: 62.69 kB │ map: 635.14 kB
✓ built in 1.46s
Removing intermediate container 79f7909b3f8d
 ---> 005c384b261f
Step 8/24 : WORKDIR /app
 ---> Running in e2bbb904f592
Removing intermediate container e2bbb904f592
 ---> e15faab032f6
Step 9/24 : COPY packages/server/package*.json ./server/
 ---> 2c3e4d800a7d
Step 10/24 : WORKDIR /app/server
 ---> Running in 2d861ee4b7f9
Removing intermediate container 2d861ee4b7f9
 ---> 35d192eae284
Step 11/24 : RUN npm install --omit=dev
 ---> Running in b1f3e014d425


added 152 packages, and audited 153 packages in 13s

26 packages are looking for funding
  run `npm fund` for details

found 0 vulnerabilities
Removing intermediate container b1f3e014d425
 ---> d5049be73a34
Step 12/24 : COPY packages/server/dist ./dist
 ---> 315baeb66db0
Step 13/24 : FROM node:20-alpine
20-alpine: Pulling from library/node
Digest: sha256:1ab6fc5a31d515dc7b6b25f6acfda2001821f2c2400252b6cb61044bd9f9ad48
Status: Image is up to date for node:20-alpine
 ---> 30c8b6e55a5d
Step 14/24 : WORKDIR /app
 ---> Using cache
 ---> 5505edd98a86
Step 15/24 : COPY --from=builder /app/server/package*.json ./
 ---> 4c72c6e5e6be
Step 16/24 : COPY --from=builder /app/server/node_modules ./node_modules
 ---> 7bebdafe6f41
Step 17/24 : COPY --from=builder /app/server/dist ./dist
 ---> 2a8496af9cbf
Step 18/24 : COPY --from=builder /app/app/dist ./app/dist
 ---> b516f5f9199c
Step 19/24 : ARG PORT=3000
 ---> Running in 585b4d1400de
Removing intermediate container 585b4d1400de
 ---> f0364adae55d
Step 20/24 : ENV PORT=$PORT
 ---> Running in f36ee1bf1275
Removing intermediate container f36ee1bf1275
 ---> cc287cd66466
Step 21/24 : ENV FRONTEND_DIST_PATH=/app/app/dist
 ---> Running in b73e9f4722d1
Removing intermediate container b73e9f4722d1
 ---> 64ff1f46f843
Step 22/24 : EXPOSE $PORT
 ---> Running in 890dabbeb9f0
Removing intermediate container 890dabbeb9f0
 ---> 531bea5014ed
Step 23/24 : HEALTHCHECK --interval=10s --timeout=5s --start-period=10s --retries=3   CMD wget --quiet --tries=1 --spider http://localhost:$PORT/api/health || exit 1
 ---> Running in 98c97f41b5db
Removing intermediate container 98c97f41b5db
 ---> 6ae35710488d
Step 24/24 : CMD ["node", "dist/index.js"]
 ---> Running in 60ff08281bca
Removing intermediate container 60ff08281bca
 ---> ddd7cbd0a291
Successfully built ddd7cbd0a291
Successfully tagged crx5oyap6bsi4si.azurecr.io/template-doctor/web:latest
Successfully tagged crx5oyap6bsi4si.azurecr.io/template-doctor/web:build-20251018-141825
2025/10/18 12:21:10 Successfully executed container: build
2025/10/18 12:21:10 Executing step ID: push. Timeout(sec): 3600, Working directory: '', Network: ''
2025/10/18 12:21:10 Pushing image: crx5oyap6bsi4si.azurecr.io/template-doctor/web:latest, attempt 1
The push refers to repository [crx5oyap6bsi4si.azurecr.io/template-doctor/web]
8168d94bbe84: Preparing
c1145e146923: Preparing
6787492e1742: Preparing
c65384cb1cb3: Preparing
7275784077ad: Preparing
0bcbdaa51a5c: Preparing
2f7c9e8727d4: Preparing
ed851c476265: Preparing
256f393e029f: Preparing
0bcbdaa51a5c: Waiting
2f7c9e8727d4: Waiting
ed851c476265: Waiting
256f393e029f: Waiting
c65384cb1cb3: Pushed
7275784077ad: Pushed
c1145e146923: Pushed
8168d94bbe84: Pushed
ed851c476265: Layer already exists
2f7c9e8727d4: Layer already exists
256f393e029f: Layer already exists
6787492e1742: Pushed
0bcbdaa51a5c: Layer already exists
latest: digest: sha256:a46a46f8b93d5fb5b4ee9a01fa91b2c725101e7e2135558995fd1c19629b534e size: 2203
2025/10/18 12:21:17 Successfully pushed image: crx5oyap6bsi4si.azurecr.io/template-doctor/web:latest
2025/10/18 12:21:17 Pushing image: crx5oyap6bsi4si.azurecr.io/template-doctor/web:build-20251018-141825, attempt 1
The push refers to repository [crx5oyap6bsi4si.azurecr.io/template-doctor/web]
8168d94bbe84: Preparing
c1145e146923: Preparing
6787492e1742: Preparing
c65384cb1cb3: Preparing
7275784077ad: Preparing
0bcbdaa51a5c: Preparing
2f7c9e8727d4: Preparing
ed851c476265: Preparing
256f393e029f: Preparing
ed851c476265: Waiting
0bcbdaa51a5c: Waiting
2f7c9e8727d4: Waiting
256f393e029f: Waiting
8168d94bbe84: Layer already exists
7275784077ad: Layer already exists
6787492e1742: Layer already exists
c1145e146923: Layer already exists
c65384cb1cb3: Layer already exists
ed851c476265: Layer already exists
2f7c9e8727d4: Layer already exists
0bcbdaa51a5c: Layer already exists
256f393e029f: Layer already exists
build-20251018-141825: digest: sha256:a46a46f8b93d5fb5b4ee9a01fa91b2c725101e7e2135558995fd1c19629b534e size: 2203
2025/10/18 12:21:18 Successfully pushed image: crx5oyap6bsi4si.azurecr.io/template-doctor/web:build-20251018-141825
2025/10/18 12:21:18 Step ID: build marked as successful (elapsed time in seconds: 55.838019)
2025/10/18 12:21:18 Populating digests for step ID: build...
2025/10/18 12:21:20 Successfully populated digests for step ID: build
2025/10/18 12:21:20 Step ID: push marked as successful (elapsed time in seconds: 8.104016)
2025/10/18 12:21:20 The following dependencies were found:
2025/10/18 12:21:20 
- image:
    registry: crx5oyap6bsi4si.azurecr.io
    repository: template-doctor/web
    tag: latest
    digest: sha256:a46a46f8b93d5fb5b4ee9a01fa91b2c725101e7e2135558995fd1c19629b534e
  runtime-dependency:
    registry: registry.hub.docker.com
    repository: library/node
    tag: 20-alpine
    digest: sha256:1ab6fc5a31d515dc7b6b25f6acfda2001821f2c2400252b6cb61044bd9f9ad48
  git: {}
- image:
    registry: crx5oyap6bsi4si.azurecr.io
    repository: template-doctor/web
    tag: build-20251018-141825
    digest: sha256:a46a46f8b93d5fb5b4ee9a01fa91b2c725101e7e2135558995fd1c19629b534e
  runtime-dependency:
    registry: registry.hub.docker.com
    repository: library/node
    tag: 20-alpine
    digest: sha256:1ab6fc5a31d515dc7b6b25f6acfda2001821f2c2400252b6cb61044bd9f9ad48
  git: {}

Run ID: dtk was successful after 1m11s

✅ Image built successfully with tags: latest, build-20251018-141825

🔄 Updating Container App...
   App: ca-web-x5oyap6bsi4si
   Resource Group: rg-nv-azd-template-doctor
   Using timestamped image: build-20251018-141825

WARNING: The behavior of this command has been altered by the following extension: containerapp
/ Running ..| Running ..\ Running ..[K{
  "id": "/subscriptions/3bcbef31-23b0-4d82-9ee4-192d70bd4a14/resourceGroups/rg-nv-azd-template-doctor/providers/Microsoft.App/containerapps/ca-web-x5oyap6bsi4si",
  "identity": {
    "principalId": "ce402863-28da-4762-9384-68f66451b049",
    "tenantId": "72f988bf-86f1-41af-91ab-2d7cd011db47",
    "type": "SystemAssigned"
  },
  "location": "Sweden Central",
  "name": "ca-web-x5oyap6bsi4si",
  "properties": {
    "configuration": {
      "activeRevisionsMode": "Single",
      "dapr": null,
      "identitySettings": [],
      "ingress": {
        "additionalPortMappings": null,
        "allowInsecure": false,
        "clientCertificateMode": null,
        "corsPolicy": null,
        "customDomains": null,
        "exposedPort": 0,
        "external": true,
        "fqdn": "ca-web-x5oyap6bsi4si.wittyplant-825c5911.swedencentral.azurecontainerapps.io",
        "ipSecurityRestrictions": null,
        "stickySessions": null,
        "targetPort": 3000,
        "targetPortHttpScheme": null,
        "traffic": [
          {
            "latestRevision": true,
            "weight": 100
          }
        ],
        "transport": "Auto"
      },
      "maxInactiveRevisions": null,
      "registries": [
        {
          "identity": "",
          "passwordSecretRef": "registry-password",
          "server": "crx5oyap6bsi4si.azurecr.io",
          "username": "crx5oyap6bsi4si"
        }
      ],
      "revisionTransitionThreshold": null,
      "runtime": null,
      "secrets": [
        {
          "name": "registry-password"
        },
        {
          "name": "github-client-id"
        },
        {
          "name": "github-client-secret"
        },
        {
          "name": "github-token"
        },
        {
          "name": "gh-workflow-token"
        }
      ],
      "service": null,
      "targetLabel": ""
    },
    "customDomainVerificationId": "AF9D90B0F297A3EA09278B3D2C1F04ADEAE53A581659890A929CB33FFF57DA82",
    "delegatedIdentities": [],
    "environmentId": "/subscriptions/3bcbef31-23b0-4d82-9ee4-192d70bd4a14/resourceGroups/rg-nv-azd-template-doctor/providers/Microsoft.App/managedEnvironments/cae-x5oyap6bsi4si",
    "eventStreamEndpoint": "https://swedencentral.azurecontainerapps.dev/subscriptions/3bcbef31-23b0-4d82-9ee4-192d70bd4a14/resourceGroups/rg-nv-azd-template-doctor/containerApps/ca-web-x5oyap6bsi4si/eventstream",
    "latestReadyRevisionName": "ca-web-x5oyap6bsi4si--0000007",
    "latestRevisionFqdn": "ca-web-x5oyap6bsi4si--0000008.wittyplant-825c5911.swedencentral.azurecontainerapps.io",
    "latestRevisionName": "ca-web-x5oyap6bsi4si--0000008",
    "managedEnvironmentId": "/subscriptions/3bcbef31-23b0-4d82-9ee4-192d70bd4a14/resourceGroups/rg-nv-azd-template-doctor/providers/Microsoft.App/managedEnvironments/cae-x5oyap6bsi4si",
    "outboundIpAddresses": [
      "20.240.85.129"
    ],
    "patchingMode": "Automatic",
    "provisioningState": "Succeeded",
    "runningStatus": "Running",
    "template": {
      "containers": [
        {
          "env": [
            {
              "name": "MONGODB_URI"
            },
            {
              "name": "MONGODB_DATABASE"
            },
            {
              "name": "NODE_ENV"
            },
            {
              "name": "PORT"
            },
            {
              "name": "FRONTEND_DIST_PATH"
            },
            {
              "name": "GITHUB_TOKEN_ANALYZER",
              "secretRef": "github-token"
            },
            {
              "name": "ADMIN_GITHUB_USERS"
            },
            {
              "name": "DEFAULT_RULE_SET"
            },
            {
              "name": "REQUIRE_AUTH_FOR_RESULTS"
            },
            {
              "name": "AUTO_SAVE_RESULTS"
            },
            {
              "name": "ARCHIVE_ENABLED"
            },
            {
              "name": "ARCHIVE_COLLECTION"
            },
            {
              "name": "DISPATCH_TARGET_REPO"
            },
            {
              "name": "ISSUE_AI_ENABLED"
            },
            {
              "name": "GITHUB_CLIENT_ID",
              "secretRef": "github-client-id"
            },
            {
              "name": "GITHUB_CLIENT_SECRET",
              "secretRef": "github-client-secret"
            },
            {
              "name": "GITHUB_TOKEN",
              "secretRef": "github-token"
            },
            {
              "name": "GH_WORKFLOW_TOKEN",
              "secretRef": "gh-workflow-token"
            },
            {
              "name": "TD_BACKEND_BASE_URL"
            },
            {
              "name": "BUILD_TIMESTAMP"
            },
            {
              "name": "BUILD_TAG"
            }
          ],
          "image": "crx5oyap6bsi4si.azurecr.io/template-doctor/web:build-20251018-141825",
          "imageType": "ContainerImage",
          "name": "main",
          "resources": {
            "cpu": 0.5,
            "ephemeralStorage": "2Gi",
            "memory": "1Gi"
          }
        }
      ],
      "initContainers": null,
      "revisionSuffix": "",
      "scale": {
        "cooldownPeriod": 300,
        "maxReplicas": 3,
        "minReplicas": 1,
        "pollingInterval": 30,
        "rules": [
          {
            "http": {
              "metadata": {
                "concurrentRequests": ""
              }
            },
            "name": "http-scaling"
          }
        ]
      },
      "serviceBinds": null,
      "terminationGracePeriodSeconds": null,
      "volumes": null
    },
    "workloadProfileName": null
  },
  "resourceGroup": "rg-nv-azd-template-doctor",
  "systemData": {
    "createdAt": "2025-10-16T10:49:35.8968332",
    "createdBy": "nvenditto@microsoft.com",
    "createdByType": "User",
    "lastModifiedAt": "2025-10-18T12:21:34.0338314",
    "lastModifiedBy": "nvenditto@microsoft.com",
    "lastModifiedByType": "User"
  },
  "tags": {
    "app": "template-doctor",
    "azd-env-name": "nv-azd-template-doctor"
  },
  "type": "Microsoft.App/containerApps"
}

⏳ Waiting for new revision to be ready...
   Latest revision: ca-web-x5oyap6bsi4si--0000007
   Deployed image: crx5oyap6bsi4si.azurecr.io/template-doctor/web:latest
   ⚠️  Warning: Image tag mismatch!
      Expected: build-20251018-141825
      Deployed: crx5oyap6bsi4si.azurecr.io/template-doctor/web:latest

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ Deployment Complete!
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🌐 Application URL: https://ca-web-x5oyap6bsi4si.wittyplant-825c5911.swedencentral.azurecontainerapps.io
🏷️  Build Tag: build-20251018-141825
� Build Timestamp: 20251018-141825

�📝 Next steps:
   1. Wait 30-60 seconds for container to fully start
   2. Hard refresh your browser (Cmd+Shift+R / Ctrl+Shift+R)
   3. Check build info: https://ca-web-x5oyap6bsi4si.wittyplant-825c5911.swedencentral.azurecontainerapps.io/api/health
   4. Update GitHub OAuth app callback URL if needed:
      https://ca-web-x5oyap6bsi4si.wittyplant-825c5911.swedencentral.azurecontainerapps.io/callback.html

🔍 Verify deployment:
   curl https://ca-web-x5oyap6bsi4si.wittyplant-825c5911.swedencentral.azurecontainerapps.io/api/health | jq '.env.BUILD_TAG'
   Should return: "build-20251018-141825"

